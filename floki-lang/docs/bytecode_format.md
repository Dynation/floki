# Floki Bytecode Format (FUF)

Floki Unified Format (**FUF**) ‚Äî —Ü–µ **–±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç** –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º Floki.  
–í—ñ–Ω –¥–æ–∑–≤–æ–ª—è—î —à–≤–∏–¥–∫–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ —Ç–∞ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ Floki-–∫–æ–¥ –±–µ–∑ –ø–æ—Ç—Ä–µ–±–∏ —É —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –ø–∞—Ä—Å–∏–Ω–≥—É.

---

## 1Ô∏è‚É£ –ó–∞–≥–æ–ª–æ–≤–æ–∫ (HEADER)
–¶—è —á–∞—Å—Ç–∏–Ω–∞ –º—ñ—Å—Ç–∏—Ç—å –º–µ—Ç–∞—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ñ–∞–π–ª:

| –ü–æ–ª–µ         | –†–æ–∑–º—ñ—Ä  | –û–ø–∏—Å |
|-------------|--------|-----------------------------------|
| `FUF_MAGIC` | 4 –±–∞–π—Ç–∏ | –°–∏–≥–Ω–∞—Ç—É—Ä–∞ `FUF\x00` –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ñ–∞–π–ª—É |
| `VERSION`   | 2 –±–∞–π—Ç–∏ | –í–µ—Ä—Å—ñ—è —Ñ–æ—Ä–º–∞—Ç—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `0x0100` –¥–ª—è 1.0) |
| `CHECKSUM`  | 4 –±–∞–π—Ç–∏ | –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞ —Å—É–º–∞ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ |
| `STATE_COUNT` | 2 –±–∞–π—Ç–∏ | –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç–∞–Ω—ñ–≤ —É –ø—Ä–æ–≥—Ä–∞–º—ñ |
| `GAIT_COUNT` | 2 –±–∞–π—Ç–∏ | –ö—ñ–ª—å–∫—ñ—Å—Ç—å —à–∞–±–ª–æ–Ω—ñ–≤ —Ä—É—Ö—É |
| `EVENT_COUNT` | 2 –±–∞–π—Ç–∏ | –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–¥—ñ–π —É –±–∞–π—Ç–∫–æ–¥—ñ |
| `SENSOR_COUNT` | 2 –±–∞–π—Ç–∏ | –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–µ–Ω—Å–æ—Ä—ñ–≤, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è |
| `ACTION_COUNT` | 2 –±–∞–π—Ç–∏ | –ö—ñ–ª—å–∫—ñ—Å—Ç—å –º–æ—Ç–æ—Ä—ñ–≤ –∞–±–æ –¥—ñ–π |
| `MEMORY_SIZE` | 4 –±–∞–π—Ç–∏ | –í–∏–¥—ñ–ª–µ–Ω–∞ –ø–∞–º‚Äô—è—Ç—å –¥–ª—è –∑–º—ñ–Ω–Ω–∏—Ö —Å—Ç–∞–Ω—É |
| `FLAGS` | 2 –±–∞–π—Ç–∏ | –§–ª–∞–≥–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ä–µ–∂–∏–º —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É) |

---

## 2Ô∏è‚É£ –¢–∞–±–ª–∏—Ü—è —Å–µ–Ω—Å–æ—Ä—ñ–≤ (SENSORS)
–ü–µ—Ä–µ–ª—ñ–∫ —É—Å—ñ—Ö —Å–µ–Ω—Å–æ—Ä—ñ–≤, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —É Floki-–ø—Ä–æ–≥—Ä–∞–º—ñ.

| –ü–æ–ª–µ        | –†–æ–∑–º—ñ—Ä | –û–ø–∏—Å |
|-------------|--------|-----------------------------|
| `ID`        | 1 –±–∞–π—Ç | –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID —Å–µ–Ω—Å–æ—Ä–∞ |
| `TYPE`      | 1 –±–∞–π—Ç | –¢–∏–ø (0 = –∞–Ω–∞–ª–æ–≥–æ–≤–∏–π, 1 = —Ü–∏—Ñ—Ä–æ–≤–∏–π, 2 = —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π) |
| `ADDRESS`   | 2 –±–∞–π—Ç–∏ | –§—ñ–∑–∏—á–Ω–∞ –∞–¥—Ä–µ—Å–∞ —Å–µ–Ω—Å–æ—Ä–∞ |
| `THRESHOLD` | 4 –±–∞–π—Ç–∏ | –ü–æ—Ä—ñ–≥ —Å–ø—Ä–∞—Ü—å–æ–≤—É–≤–∞–Ω–Ω—è |

### **–ü—Ä–∏–∫–ª–∞–¥ —É –±–∞–π—Ç–∫–æ–¥—ñ:**
[SENSOR] ID=0x01, TYPE=0x01, ADDR=0x1001, THRESHOLD=0.7  
[SENSOR] ID=0x02, TYPE=0x00, ADDR=0x1002, THRESHOLD=0.5

---

## 3Ô∏è‚É£ –¢–∞–±–ª–∏—Ü—è –º–æ—Ç–æ—Ä—ñ–≤ (ACTIONS)
–ü–µ—Ä–µ–ª—ñ–∫ —É—Å—ñ—Ö –º–æ—Ç–æ—Ä—ñ–≤ –∞–±–æ –¥—ñ–π, —è–∫—ñ –º–æ–∂–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —Å–∏—Å—Ç–µ–º–∞.

| –ü–æ–ª–µ        | –†–æ–∑–º—ñ—Ä | –û–ø–∏—Å |
|-------------|--------|-----------------------------|
| `ID`        | 1 –±–∞–π—Ç | –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID –º–æ—Ç–æ—Ä–∞ |
| `TYPE`      | 1 –±–∞–π—Ç | –¢–∏–ø (0 = PWM, 1 = —Ä–µ–ª–µ–π–Ω–∏–π, 2 = —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π) |
| `ADDRESS`   | 2 –±–∞–π—Ç–∏ | –ê–¥—Ä–µ—Å–∞ –ø—Ä–∏—Å—Ç—Ä–æ—é |
| `POWER`     | 4 –±–∞–π—Ç–∏ | –ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å —É –≤—ñ–¥—Å–æ—Ç–∫–∞—Ö (0.0 - 1.0) |

### **–ü—Ä–∏–∫–ª–∞–¥ —É –±–∞–π—Ç–∫–æ–¥—ñ:**
[ACTION] ID=0x01, TYPE=0x00, ADDR=0x2001, POWER=0.9  
[ACTION] ID=0x02, TYPE=0x01, ADDR=0x2002, POWER=0.3

---

## 4Ô∏è‚É£ –õ–æ–≥—ñ–∫–∞ –ø–æ–¥—ñ–π (EVENTS)
–¶–µ –æ—Å–Ω–æ–≤–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞ FUF ‚Äî **–ª–æ–≥—ñ–∫–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ Floki**.

| –ü–æ–ª–µ        | –†–æ–∑–º—ñ—Ä | –û–ø–∏—Å |
|-------------|--------|--------------------------|
| `EVENT_ID`  | 1 –±–∞–π—Ç | –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID –ø–æ–¥—ñ—ó |
| `SENSOR_ID` | 1 –±–∞–π—Ç | ID —Å–µ–Ω—Å–æ—Ä–∞, —è–∫–∏–π –∑–∞–ø—É—Å–∫–∞—î –ø–æ–¥—ñ—é |
| `CONDITION` | 1 –±–∞–π—Ç | 0 = `>`, 1 = `<`, 2 = `==` |
| `VALUE`     | 4 –±–∞–π—Ç–∏ | –ü–æ—Ä–æ–≥–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è —Ç—Ä–∏–≥–µ—Ä—É |
| `ACTION_ID` | 1 –±–∞–π—Ç | ID –¥—ñ—ó, —è–∫–∞ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è |
| `DURATION`  | 2 –±–∞–π—Ç–∏ | –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –¥—ñ—ó –≤ –º—Å |

### **–ü—Ä–∏–∫–ª–∞–¥ —É –±–∞–π—Ç–∫–æ–¥—ñ:**
[EVENT] ID=0x10, SENSOR=0x01, COND=0x00, VAL=0.6, ACTION=0x01, DURATION=1000  
[EVENT] ID=0x11, SENSOR=0x02, COND=0x01, VAL=0.4, ACTION=0x02, DURATION=500

–¶–µ –æ–∑–Ω–∞—á–∞—î:
1. –Ø–∫—â–æ **—Å–µ–Ω—Å–æ—Ä 1 > 0.6**, –≤–∫–ª—é—á–∞—î—Ç—å—Å—è –º–æ—Ç–æ—Ä 1 –Ω–∞ **1 —Å–µ–∫—É–Ω–¥—É**.
2. –Ø–∫—â–æ **—Å–µ–Ω—Å–æ—Ä 2 < 0.4**, –≤–∫–ª—é—á–∞—î—Ç—å—Å—è –º–æ—Ç–æ—Ä 2 –Ω–∞ **0.5 —Å–µ–∫—É–Ω–¥–∏**.

---

## 5Ô∏è‚É£ –ó–∞–∫–ª—é—á–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞ (FOOTER)

| –ü–æ–ª–µ        | –†–æ–∑–º—ñ—Ä | –û–ø–∏—Å |
|-------------|--------|----------------|
| `EVENT_MAP` | `N` –±–∞–π—Ç | –Ü–Ω–¥–µ–∫—Å–∏ –≤—Å—ñ—Ö –ø–æ–¥—ñ–π –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø—É |
| `CHECKSUM`  | 4 –±–∞–π—Ç–∏ | –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞ —Å—É–º–∞ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–æ–º–∏–ª–æ–∫ |

---

## **üìå –í–∏—Å–Ω–æ–≤–∫–∏**
- **FUF ‚Äî —Ü–µ –∫–æ–º–ø–∞–∫—Ç–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è Floki-–ø—Ä–æ–≥—Ä–∞–º** —É –±–∞–π—Ç–æ–≤–æ–º—É –≤–∏–≥–ª—è–¥—ñ.
- **–í—ñ–Ω –¥–æ–∑–≤–æ–ª—è—î —à–≤–∏–¥–∫–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ —Ç–∞ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫–æ–¥** –±–µ–∑ –ø–∞—Ä—Å–∏–Ω–≥—É —Ç–µ–∫—Å—Ç—É.
- **–¶–µ –æ—Å–Ω–æ–≤–∞ –¥–ª—è Floki-VM**, —è–∫–∏–π –±—É–¥–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –±–∞–π—Ç–∫–æ–¥ –±–µ–∑ –ø–æ—Ç—Ä–µ–±–∏ —É –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó –ø—ñ–¥ –∫–æ–∂–Ω–µ –Ω–æ–≤–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ.

---


## **üìå –©–æ –¥–∞–ª—ñ?**
1. **–î–æ–¥–∞—Ç–∏ `compiler/floki_to_fuf.py`** ‚Äî —Å–∫—Ä–∏–ø—Ç, —è–∫–∏–π –∫–æ–º–ø—ñ–ª—é—î Floki-–∫–æ–¥ —É FUF.
2. **–†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ `vm/floki_vm.py`** ‚Äî –ø—Ä–æ—Å—Ç–∏–π —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è FUF-—Ñ–∞–π–ª—ñ–≤.
3. **–ù–∞–ø–∏—Å–∞—Ç–∏ –±—ñ–ª—å—à–µ —Ç–µ—Å—Ç—ñ–≤** –¥–ª—è –±–∞–π—Ç–∫–æ–¥—É.
